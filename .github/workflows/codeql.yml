name: CodeQL Analysis

on:
  push:
    branches: [ main, workflow ]
  pull_request:
    branches: [ main ]

jobs:
  build:
    runs-on: ubuntu-latest

    steps:
    - name: Checkout repository
      uses: actions/checkout@v2

    # Installation des dépendances UHD
    - name: Install UHD dependencies
      run: |
        sudo apt update
        sudo apt-get install -y autoconf automake build-essential ccache cmake cpufrequtils doxygen ethtool \
          g++ git inetutils-tools libboost-all-dev libncurses5 libncurses5-dev libusb-1.0-0 libusb-1.0-0-dev \
          libusb-dev python3-dev python3-mako python3-numpy python3-requests python3-scipy python3-setuptools \
          python3-ruamel.yaml

    # Clonage et construction de UHD à partir de la source
    - name: Clone and build UHD from source
      run: |
        git clone https://github.com/EttusResearch/uhd.git
        cd uhd/host
        mkdir build
        cd build
        cmake ../
        make -j 4
        make test
        sudo make install
        sudo ldconfig

    # Téléchargement des firmwares pour les USRPs
    - name: Download firmwares for USRPs
      run: sudo uhd_images_downloader

    # Installation des dépendances srsRAN
    - name: Install srsRAN dependencies
      run: |
        sudo apt-get install -y build-essential git cmake libfftw3-dev libmbedtls-dev libboost-program-options-dev \
          libconfig++-dev libsctp-dev

    # Installation des dépendances LTESniffer
    - name: Install LTESniffer dependencies
      run: |
        sudo apt-get install -y libglib2.0-dev libudev-dev libcurl4-gnutls-dev libboost-all-dev qtdeclarative5-dev \
          libqt5charts5-dev

    # Clonage et construction de LTESniffer à partir de la source
    - name: Clone and build LTESniffer from source
      run: |
        git clone https://github.com/SysSec-KAIST/LTESniffer.git
        cd LTESniffer
        mkdir build
        cd build
        cmake ../
        make -j 4

    # Analyse du code avec CodeQL
    - name: Perform CodeQL Analysis
      uses: github/codeql-action/analyze@v3
      with:
        languages: java, cpp  # Ajoutez d'autres langages si nécessaire
